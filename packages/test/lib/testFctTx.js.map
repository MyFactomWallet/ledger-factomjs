{"version":3,"sources":["../src/testFctTx.js"],"names":["require","Transaction","FactomCli","nacl","sign","cli","host","port","path","debugPath","protocol","rejectUnauthorized","retry","retries","factor","minTimeout","maxTimeout","transport","fct","Fct","amount","ecRate","getAddress","addr","fromAddr","toAddr","numinputs","numoutputs","fees","builder","input","output","build","computeRequiredFees","rcdSignatureLength","numberOfSignatures","console","log","t","marshalBinarySig","toString","signTransaction","result","ts","rcdSignature","Buffer","from","i","signatures","length","detached","verify","rcds","slice"],"mappings":"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","file":"testFctTx.js","sourcesContent":["import Fct from '@factoid.org/hw-app-fct'\nconst { Transaction} = require( 'factom/src/transaction' )\nconst { FactomCli } = require('factom/src/factom-cli')\nconst nacl = require('tweetnacl/nacl-fast').sign\n\n\nconst cli = new FactomCli({\n            //host: 'courtesy-node.factom.com',\n            host: 'localhost',\n\t    //port: 443,\n\t    port: 8088,\n\t    path: '/v2', // Path to V2 API. Default to /v2\n\t    debugPath: '/debug', // Path to debug API. Default to /debug\n\t    protocol: 'https', // http or https. Default to http\n\t    rejectUnauthorized: false, // Set to false to allow connection to a node with a self-signed certificate\n\t    retry: {\n              retries: 4,\n              factor: 2,\n              minTimeout: 500,\n              maxTimeout: 2000\n            }})\n\nexport default async transport => {\n  const fct = new Fct(transport);\n  const amount = 1000000\n  const ecRate = 22000 //await cli.getEntryCreditRate()\n  const path = \"44'/131'/0'/0/0\"\n  const addr = await fct.getAddress(path)\n  const fromAddr = addr['address']\n\n  const toAddr = 'FA3nr5r54AKBZ9SLABS3JyRoGcWMVMTkePW9MECKM8shMg2pMagn'\n\n  const numinputs = 1\n  const numoutputs = 1\n\n  const fees = Transaction.builder()\n    .input(fromAddr, amount*numoutputs)\n    .output(toAddr, amount)\n    .build()\n    .computeRequiredFees(ecRate, { rcdSignatureLength: numoutputs * (33 + 64), numberOfSignatures: numinputs })\n\n  console.log(\"*** ecRate ***\")\n  console.log(ecRate)\n  console.log(\"**************\")\n  console.log(\"***  fees  ***\")\n  console.log(fees)\n  console.log(\"***  display fees  ***\")\n  console.log(fees*1e-8)\n  console.log(\"**************\")\n  console.log(\"***  toAddr  ***\")\n  console.log(toAddr)\n  console.log(\"**************\")\n\n  const t = Transaction.builder()\n    .input(fromAddr, amount*numoutputs+fees)\n    .output(toAddr, amount)\n    .build()\n\n\n  console.log('-------------========== TXN ==========----------------')\n  console.log(t.marshalBinarySig.toString('hex'))\n  console.log('-------------========== TXN ==========----------------')\n\n  const result = await fct.signTransaction(path, t.marshalBinarySig.toString('hex'));\n\n  console.log('-------------========== SIGNATURE ==========----------------')\n  console.log(result)\n  console.log('-------------========== SIGNATURE ==========----------------')\n\n  const ts = Transaction.builder(t)\n    .rcdSignature(Buffer.from(result['r'],'hex'), Buffer.from(result['s'],'hex'))\n    .build()\n\n\n  for (let i = 0; i < ts.signatures.length; ++i) {\n    if(nacl.detached.verify(ts.marshalBinarySig, ts.signatures[i], Buffer.from(ts.rcds[i], 1).slice(1))) {\n      console.log(\"Transaction Signature is valid!!!\")\n    } else {\n      console.log(\"Transaction Signature is NOT valid!!!\")\n      throw(\"Invalid Transaction Signature\")\n    }\n  }\n  return result\n}\n"]}